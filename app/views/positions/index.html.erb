<%# positions/index.html.erb %>
<h1>ポジション一覧 - <%= @date %></h1>

<% @schedules_by_time_slot.each do |time_slot, schedules| %>
  <% time_slot_start, time_slot_end = Schedule::TIME_SLOTS[time_slot][1..2].map { |t| Time.zone.parse("#{@date} #{t}") } %>

  <h2><%= Schedule::TIME_SLOTS[time_slot]&.first || '未定義のタイムスロット' %></h2>
  <table>
    <tr>
      <th>ポジション名</th>
      <th>キャスト名</th>
      <th>操作</th>
    </tr>
    <% @positions.each do |position| %>
      <tr>
        <td><%= t("activerecord.attributes.position.#{position.position_name}") %></td>
        <td>
          <% assigned_schedule = schedules.find { |schedule| schedule.position_id == position.id } %>
          <%= assigned_schedule ? assigned_schedule.cast.full_name : '' %>
        </td>
        <td>
          <% if assigned_schedule %>
            <%= link_to '外す', remove_position_schedule_schedule_path(assigned_schedule), data: { turbo_method: :delete }, class: 'btn' %>
          <% else %>
            <%= link_to '配置', new_position_schedule_schedules_path(position_id: position.id, date: @date, time_slot: time_slot), class: 'btn' %>
          <% end %>
        </td>
      </tr>
    <% end %>
  </table>

  <%# ここに休憩スケジュールの表示を追加 %>
  <h3>休憩時間</h3>
  <table>
    <tr>
      <th>キャスト名</th>
      <th>開始時間</th>
      <th>終了時間</th>
    </tr>
    <% schedules.each do |schedule| %>
      <% if schedule.position.position_name == 'brake' %>
        <tr>
          <td><%= schedule.cast.full_name %></td>
          <td><%= schedule.start_time.strftime("%H:%M") %></td>
          <td><%= schedule.end_time.strftime("%H:%M") %></td>
        </tr>
      <% end %>
    <% end %>
  </table>
<% end %>